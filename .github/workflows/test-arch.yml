on: [push]

jobs:
  build:
    runs-on: ubuntu-20.04
    name: Build on Aarch64
    steps:
      - uses: actions/checkout@main
      - uses: uraimo/run-on-arch-action@v2.1.0
        id: runcmd
        with:
          arch: aarch64
          distro: ubuntu20.04
          run: |
            uname -a
            apt-get -y update
            apt-get -y upgrade
            apt-get -y install libreadline-dev libconfig-dev libssl-dev lua5.2 liblua5.2-dev libevent-dev libjansson-dev libpython3-dev make git zlib1g zlib1g-dev
            # git clone --recursive https://github.com/vysheng/tg.git && cd tg
            git clone --recursive https://github.com/kenorb-contrib/tg.git && cd tg
            sed -i 's/assert (0)/\/\/assert (0)/g' tgl/mtproto-utils.c
            ./configure && make -j$(nproc)
            cd ../
            tar cvf tg.tar.gz tg
            
            echo ::set-output name=uname::$(uname -a)
      - name: Get the output
        run: |
            echo "The uname output was ${{ steps.runcmd.outputs.uname }}"

      - uses: actions/upload-artifact@v2
        with:
          name: my-artifact
          path: tg
